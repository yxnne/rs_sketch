<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>我的最近活跃项目统计</title>
    <script src="https://unpkg.com/@antv/g2plot@2.4.25/dist/g2plot.min.js"></script>
    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, Segoe UI, Roboto,
          Helvetica, Arial, "Microsoft Yahei", sans-serif;
        margin: 0;
        padding: 24px;
        color: #1f1f1f;
        background: #fff;
      }
      .grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        grid-gap: 24px;
      }
      .card {
        border: 1px solid #e5e5e5;
        border-radius: 8px;
        padding: 16px;
      }
      .title {
        font-size: 18px;
        font-weight: 600;
        margin-bottom: 12px;
      }
      #topStars,
      #starsForks,
      #activity,
      #languages {
        width: 100%;
        height: 380px;
      }
      table {
        width: 100%;
        border-collapse: collapse;
      }
      th,
      td {
        border: 1px solid #e5e5e5;
        padding: 8px;
        text-align: left;
      }
      .muted {
        color: #666;
        font-size: 13px;
      }
    </style>
  </head>
  <body>
    <h2>我的最近活跃项目统计</h2>
    <p class="muted">
      数据可替换为来自本地 MCP 的 GitHub
      拉取结果（repos.json）。当前展示示例数据，格式见下文。
    </p>

    <div class="grid">
      <div class="card">
        <div class="title">Top 仓库（按 star）</div>
        <div id="topStars"></div>
      </div>
      <div class="card">
        <div class="title">仓库 star 与 fork 对比</div>
        <div id="starsForks"></div>
      </div>
      <div class="card" style="grid-column: 1/-1">
        <div class="title">最近活动趋势（按月提交数）</div>
        <div id="activity"></div>
      </div>
      <div class="card" style="grid-column: 1/-1">
        <div class="title">语言占比</div>
        <div id="languages"></div>
      </div>
      <div class="card" style="grid-column: 1/-1">
        <div class="title">仓库列表（示例）</div>
        <table>
          <thead>
            <tr>
              <th>仓库</th>
              <th>Star</th>
              <th>Fork</th>
              <th>Open Issues</th>
              <th>Open PRs</th>
              <th>最后更新时间</th>
            </tr>
          </thead>
          <tbody id="repoTable"></tbody>
        </table>
      </div>
    </div>

    <script>
      // 若同目录存在 repos.json 则使用该数据，否则用示例数据
      // 示例数据结构：
      // {
      //   repos: [{ name, stars, forks, issuesOpen, prsOpen, updatedAt }],
      //   activity: [{ month, commits }],
      //   languages: [{ language, bytes }]
      // }
      const fallback = {
        repos: [
          {
            name: "simple_redis_1",
            stars: 12,
            forks: 3,
            issuesOpen: 1,
            prsOpen: 0,
            updatedAt: "2025-12-01",
          },
          {
            name: "antv-charts-demo",
            stars: 28,
            forks: 6,
            issuesOpen: 3,
            prsOpen: 1,
            updatedAt: "2025-11-29",
          },
          {
            name: "rust-utils",
            stars: 42,
            forks: 10,
            issuesOpen: 0,
            prsOpen: 2,
            updatedAt: "2025-11-20",
          },
          {
            name: "web-dashboard",
            stars: 37,
            forks: 5,
            issuesOpen: 2,
            prsOpen: 0,
            updatedAt: "2025-11-18",
          },
          {
            name: "data-pipeline",
            stars: 55,
            forks: 12,
            issuesOpen: 4,
            prsOpen: 1,
            updatedAt: "2025-11-15",
          },
        ],
        activity: [
          { month: "2025-08", commits: 12 },
          { month: "2025-09", commits: 24 },
          { month: "2025-10", commits: 17 },
          { month: "2025-11", commits: 31 },
          { month: "2025-12", commits: 9 },
        ],
        languages: [
          { language: "Rust", bytes: 420000 },
          { language: "TypeScript", bytes: 180000 },
          { language: "Python", bytes: 90000 },
          { language: "HTML", bytes: 60000 },
        ],
      };

      async function loadData() {
        try {
          const res = await fetch("repos.json");
          if (!res.ok) throw new Error("no repos.json");
          return await res.json();
        } catch (e) {
          return fallback;
        }
      }

      function render(repos, activity, languages) {
        const { Column, Line, Pie } = G2Plot;

        // Top 仓库按 star 排序
        const top = [...repos]
          .sort((a, b) => b.stars - a.stars)
          .slice(0, 8)
          .map((r) => ({ repo: r.name, value: r.stars }));
        const topStars = new Column("topStars", {
          data: top,
          xField: "repo",
          yField: "value",
          label: { position: "top" },
          color: ["#5B8FF9"],
          xAxis: { title: { text: "仓库" } },
          yAxis: { title: { text: "Star 数" } },
        });
        topStars.render();

        // 仓库 star/fork 分组对比
        const sfData = [];
        repos.forEach((r) => {
          sfData.push({ repo: r.name, metric: "Stars", value: r.stars });
          sfData.push({ repo: r.name, metric: "Forks", value: r.forks });
        });
        const starsForks = new Column("starsForks", {
          data: sfData,
          xField: "repo",
          yField: "value",
          seriesField: "metric",
          isGroup: true,
          color: ["#5B8FF9", "#5AD8A6"],
          label: { position: "top" },
        });
        starsForks.render();

        // 月度提交趋势
        const lineData = activity.map((a) => ({
          time: a.month,
          value: a.commits,
        }));
        const activityPlot = new Line("activity", {
          data: lineData,
          xField: "time",
          yField: "value",
          color: ["#F6BD16"],
          point: { size: 4 },
          xAxis: { title: { text: "月份" } },
          yAxis: { title: { text: "提交数" } },
        });
        activityPlot.render();

        // 语言占比（若无数据则给出占位提示）
        const langData = languages.map((l) => ({
          type: l.language,
          value: l.bytes,
        }));
        if (langData.length === 0) {
          const el = document.getElementById("languages");
          el.innerHTML = '<div class="muted">暂无语言数据</div>';
        } else {
          const langPlot = new Pie("languages", {
            data: langData,
            angleField: "value",
            colorField: "type",
            radius: 0.9,
            label: { type: "outer", content: "{name} {percentage}" },
            color: ["#5B8FF9", "#5AD8A6", "#F6BD16", "#E8684A", "#6DC8EC"],
          });
          langPlot.render();
        }

        // 仓库表格
        const tbody = document.getElementById("repoTable");
        tbody.innerHTML = repos
          .map(
            (r) => `<tr>
        <td>${r.name}</td>
        <td>${r.stars}</td>
        <td>${r.forks}</td>
        <td>${r.issuesOpen}</td>
        <td>${r.prsOpen}</td>
        <td>${r.updatedAt}</td>
      </tr>`
          )
          .join("");
      }

      (async () => {
        const data = await loadData();
        render(data.repos, data.activity, data.languages);
      })();
    </script>
  </body>
</html>
